if game.PlaceId ~= 7326500950 then
    return
end
if _G.Injected ~= nil then
    return
else
    _G.Injected = true
end
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()
local UserInputService = game:GetService("UserInputService")
local namecall
if Player == nil then
    game.Players:GetPropertyChangedSignal("LocalPlayer"):Wait()
    Player = game.Players.LocalPlayer
end

game.StarterGui:SetCore("SendNotification", {
    Title = 'LOADING';
    Text = "Loading script. Enter a round to fully load.";
    Icon = "rbxassetid://2541869220";
    Duration = 7;
})


local Toggles = {
    Killaura = false;
    InfStamina = false;
    AutoBlock = false;
}

local Debounces = {
    KillAura = false;
}

local Variables = {
    -- Values --

    KillAuraDistance = 40;

    -- Connections --

    RenderStepConnection = nil;
    StaminaUpdateConnection = nil;

}

local Tables = {
    SuperRun = {
        WHeld = false;
        SHeld = false;
        AHeld = false;
        DHeld = false;
        ShiftHeld = false;
        RunSpeed = 1;
    };
    Lists = {
        DamageTypes = {"burning","bleed","toxicated","sepsis"};
        LoopedFeatures = {"KillAura","SuperRun"};
    }
}

-- ESSENTIAL FUNCTIONS --

local function GrabMainScript()
    local Script = nil
    for i,v in pairs(Player.Backpack.GetChildren(Player.Backpack)) do
        if v:IsA("LocalScript") and v.Name ~= "ClickDetectorScript" then
            Script = v
        end
    end
    return Script
end;

local function GetArgs(inputstring)
    inputstring = string.lower(inputstring)
    inputstring = string.gsub(inputstring, "'", "")
    inputstring = string.gsub(inputstring, ":", "")
    inputstring = string.gsub(inputstring, ";", "")
    inputstring = string.gsub(inputstring, "%.", "")
    inputstring = string.gsub(inputstring, "/e ", "")
    inputstring = string.gsub(inputstring, "/w ", "")
    local args = string.split(inputstring, " ")
    args.Command = args[1]
    table.remove(args, 1)
    return args
end;

-- FEATURE FUNCTIONS -- 

local function Attack(Model,UntilDeath)
    game:GetService("ReplicatedStorage").Server.Events.Attack:FireServer("Charged", Model, 1, 1.0478, true)
end

-- CONNECTION FUNCTIONS -- 

local function RenderStepped()
    if Tables.SuperRun.ShiftHeld == true and Toggles.SuperRun == true and Player.Character ~= nil and Player.Character:FindFirstChild("HumanoidRootPart") then
        if Tables.SuperRun.WHeld == true then
            Player.Character.HumanoidRootPart.CFrame = Player.Character.HumanoidRootPart.CFrame * CFrame.new(0,0,-Tables.SuperRun.RunSpeed)
        end
        if Tables.SuperRun.SHeld == true then
            Player.Character.HumanoidRootPart.CFrame = Player.Character.HumanoidRootPart.CFrame * CFrame.new(0,0,Tables.SuperRun.RunSpeed)
        end
        if Tables.SuperRun.DHeld == true then
            Player.Character.HumanoidRootPart.CFrame = Player.Character.HumanoidRootPart.CFrame * CFrame.new(Tables.SuperRun.RunSpeed,0,0)
        end
        if Tables.SuperRun.AHeld == true then
            Player.Character.HumanoidRootPart.CFrame = Player.Character.HumanoidRootPart.CFrame * CFrame.new(-Tables.SuperRun.RunSpeed,0,0)
        end
    end
    if Toggles.KillAura and not Debounces.KillAura then
        Debounces.KillAura = true
        local Enemies = Players:GetPlayers()
        for i = 1,#Enemies do
            if Enemies[i] ~= Player and Enemies[i].Character ~= nil then
                local Character = Enemies[i].Character
                if Character ~= nil and Character:FindFirstChild("HumanoidRootPart") and Player:DistanceFromCharacter(Character.HumanoidRootPart.Position) <= Variables.KillAuraDistance then
                    Attack(Character)
                end
            end
        end
        wait(0.6)
        Debounces.KillAura = false
    end
end

-- Meta Functions --

namecall = hookmetamethod(game, "__namecall", function(self, ...)
    local Method = getnamecallmethod()
    if Method == "FireServer" or Method == "InvokeServer" then
        local Args = {...}
        local RemoteName = tostring(self)
        if RemoteName == "Update" then
           if Toggles.InfStamina and Args[1] == "Stamina" then
               return
           elseif Toggles.AutoBlock and not checkcaller() and Args[1] == "Blocking" and Args[2] == false then
               return
           end
        end
        if RemoteName == "Attack" then
            if Toggles.AutoBlock then
                game.ReplicatedStorage.Server.Events.Update.FireServer(game.ReplicatedStorage.Server.Events.Update,"Blocking", false)
                spawn(function()
                    task.wait()
                    game.ReplicatedStorage.Server.Events.Update.FireServer(game.ReplicatedStorage.Server.Events.Update,"Blocking", true)
                end)
                return namecall(self, ...)
            end
        end
    end
    return namecall(self, ...)
end)

-- Commands & Command Handling --

local Commands = {
    --[[
    template = {
        Aliases = {};
        Description = "";
        Function = function(Enabling,Args)
            Toggles.COMMAND = Enabling
            local currenttext = ""
            if Enabling == true then
                currenttext = "COMMAND is now ON!"
            else
                currenttext = "COMMAND is now OFF!"
            end
            game.StarterGui:SetCore("SendNotification", {
                Title = "notification";
                Text = currenttext;
                Icon = "rbxassetid://2541869220";
                Duration = 3;
            })
        end;
    };
    --]]
    killaura = {
        Aliases = {"killaura","murderaura","proximitykill","closekill","killclose"};
        Description = "Attacks anyone close to you.";
        Function = function(Enabling,Args)
            local Amount = tonumber(Args[1]) or tonumber(Args[2])
            if Amount ~= nil then
                Variables.KillAuraDistance = Amount
                game.StarterGui:SetCore("SendNotification", {
                    Title = "notification";
                    Text = "KillAura distance is now "..tostring(Amount);
                    Icon = "rbxassetid://2541869220";
                    Duration = 3;
                })
                return
            end
            Toggles.KillAura = Enabling
            local currenttext = ""
            if Enabling == true then
                if Variables.RenderStepConnection == nil then
                    Variables.RenderStepConnection = game:GetService("RunService").Stepped:Connect(RenderStepped)
                end
                currenttext = "KillAura is now ON!"
            else
                local LoopOff = false
                for i = 1,#Tables.Lists.LoopedFeatures do
                    if Toggles[Tables.Lists.LoopedFeatures[i]] == true then
                        LoopOff = true
                        break
                    end
                end
                if Variables.RenderStepConnection ~= nil and LoopOff then
                    Variables.RenderStepConnection:Disconnect()
                    Variables.RenderStepConnection = nil
                end
                currenttext = "KillAura is now OFF!"
            end
            game.StarterGui:SetCore("SendNotification", {
                Title = "notification";
                Text = currenttext;
                Icon = "rbxassetid://2541869220";
                Duration = 3;
            })
        end;
    };
    infstamina = {
        Aliases = {"stamina","noexhaust","noexhaustion","infrun","infstam","infinitestamina","infiniterun","infinitestam","stam"};
        Description = "Gives you infinite stamina";
        Function = function(Enabling,Args)
            if not Player.PlayerGui:FindFirstChild("HUD") or not Player.PlayerGui.HUD:FindFirstChild("StaminaFrame") then
                return
            end
            Toggles.InfStamina = Enabling
            local currenttext = ""
            local TempEnv = getsenv(GrabMainScript())
            local StaminaFrame = Player.PlayerGui.HUD.StaminaFrame
            if TempEnv == nil or StaminaFrame == nil then
                return
            end
            local UpValues = getupvalues(TempEnv.Stagger)
            if Enabling == true then
                for i,v in pairs(UpValues) do
                    if v == tonumber(StaminaFrame.EmptyBar.TextLabel.Text) then
                        setupvalue(TempEnv.Stagger,i,100)
                        if Variables.StaminaUpdateConnection == nil then
                            Variables.StaminaUpdateConnection = StaminaFrame.EmptyBar.TextLabel.Changed:Connect(function()
                                 local TempEnv = getsenv(GrabMainScript())
                                 setupvalue(TempEnv.Stagger,i,100) 
                            end)
                        end
                    end
                end
                StaminaFrame.EmptyBar.TextLabel.Text = 100
                currenttext = "InfStamina is now ON!"
            else
                if Variables.StaminaUpdateConnection ~= nil and LoopOff then
                    Variables.StaminaUpdateConnection:Disconnect()
                    Variables.StaminaUpdateConnection = nil
                end
                for i,v in pairs(UpValues) do
                    if v == tonumber(StaminaFrame.EmptyBar.TextLabel.Text) then
                        setupvalue(TempEnv.Stagger,i,ToSet)
                    end
                end
                StaminaFrame.TextLabel.Text = ToSet
                currenttext = "InfStamina is now OFF!"
            end
            TempEnv = nil
            UpValues = nil
            StaminaFrame = nil
            game.StarterGui:SetCore("SendNotification", {
                Title = "notification";
                Text = currenttext;
                Icon = "rbxassetid://2541869220";
                Duration = 3;
            })
        end;
    };
    autoblock = {
        Aliases = {"autoparry","nodamage","autocounter","blockauto","alwaysblock"};
        Description = "Blocks incoming melee attacks";
        Function = function(Enabling,Args)
            Toggles.AutoBlock = Enabling
            local currenttext = ""
            if Enabling == true then
                game:GetService("ReplicatedStorage").Server.Events.Update:FireServer("Blocking", true)
                currenttext = "AutoBlock is now ON!"
            else
                game:GetService("ReplicatedStorage").Server.Events.Update:FireServer("Blocking", false)
                currenttext = "AutoBlock is now OFF!"
            end
            game.StarterGui:SetCore("SendNotification", {
                Title = "notification";
                Text = currenttext;
                Icon = "rbxassetid://2541869220";
                Duration = 3;
            })
        end;
    };
}

Player.Chatted:Connect(function(Message)
    local Args = GetArgs(Message)
    local Prefix = string.sub(Args.Command,1,2)
    local Enabling = true
    if Prefix == "un" then
        Args.Command = string.sub(Args.Command,3,-1)
        Enabling = false
    end
    if Commands[Args.Command] then
        Commands[Args.Command].Function(Enabling,Args)
    else
        for i,v in pairs(Commands) do
            if table.find(v.Aliases, Args.Command) then
                v.Function(Enabling,Args)
                break
            end
        end
    end
end)

-- GUI HANDLING --

local Holder = Instance.new("ScreenGui")
local CommandBar = Instance.new("TextBox",Holder)
local CommandList = Instance.new("ScrollingFrame",Holder)

CommandBar.Name = "CommandBar"
CommandBar.Parent = Holder
CommandBar.BackgroundTransparency = 0
CommandBar.BorderSizePixel = 0
CommandBar.Position = UDim2.new(1, -240, 0.6, 0)
CommandBar.Size = UDim2.new(0, 240, 0, 25)
CommandBar.Font = Enum.Font.SourceSans
CommandBar.TextSize = 18
CommandBar.TextXAlignment = Enum.TextXAlignment.Left
CommandBar.TextColor3 = Color3.new(1, 1, 1)
CommandBar.BackgroundColor3 = Color3.new(54/255,57/255,63/255)
CommandBar.Text = ""
CommandBar.ZIndex = 10
CommandBar.PlaceholderText = "Press ' or click here to type commands"

CommandList.Name = "CMDs"
CommandList.Parent = Holder
CommandList.BackgroundTransparency = 0
CommandList.BorderSizePixel = 0
CommandList.Position = UDim2.new(1, -240, 0.6, 25)
CommandList.Size = UDim2.new(0, 240, 0, 175)
CommandList.ScrollBarImageColor3 = Color3.fromRGB(78,78,79)
CommandList.BackgroundColor3 = Color3.new(54/255,57/255,63/255)
CommandList.BottomImage = "rbxasset://textures/ui/Scroll/scroll-middle.png"
CommandList.CanvasSize = UDim2.new(0, 0, 0, 0)
CommandList.MidImage = "rbxasset://textures/ui/Scroll/scroll-middle.png"
CommandList.ScrollBarThickness = 8
CommandList.TopImage = "rbxasset://textures/ui/Scroll/scroll-middle.png"
CommandList.VerticalScrollBarInset = 'Always'
CommandList.ZIndex = 10
CommandList.Visible = false

local Button = Instance.new("TextButton")
Button.Name = "Button"
Button.BackgroundTransparency = 1
Button.BorderSizePixel = 0
Button.Size = UDim2.new(0, 190, 0, 20)
Button.Visible = false
Button.Font = Enum.Font.SourceSans
Button.TextSize = 18
Button.Text = "Button"
Button.TextColor3 = Color3.new(1, 1, 1)
Button.TextXAlignment = Enum.TextXAlignment.Left
Button.ZIndex = 10

local ListLayout = Instance.new("UIListLayout", CommandList)


Holder.Parent = game.CoreGui

CommandBar.Focused:Connect(function()
    CommandList.Visible = true
    for i,v in pairs(CommandList:GetChildren()) do
        if v:IsA("TextButton") then
            v.Visible = true
        end
    end
end)

CommandBar.FocusLost:Connect(function(enterpressed, input)
    if enterpressed then
        game.Players:Chat(CommandBar.Text)
    end
    wait()
    CommandList.Visible = false
    for i,v in pairs(CommandList:GetChildren()) do
        if v:IsA("TextButton") then
            v.Visible = false
        end
    end
    CommandBar.Text = ""
end)

CommandBar:GetPropertyChangedSignal("Text"):Connect(function()
    if CommandBar.Text == "'" then
        CommandBar.Text = ""
    end
    for i,v in pairs(CommandList:GetChildren()) do
        if v:IsA("TextButton") then
            if string.sub(string.lower(v.Text), 0, #CommandBar.Text) ~= string.lower(CommandBar.Text) then
                v.Visible = false
            else
                v.Visible = true
            end
        end
    end
end)


for i,v in pairs(Commands) do
    local new = Button:Clone()
    new.Parent = CommandList
    new.Visible = false
    new.Name = i
    new.Text = string.gsub(i, "_", " ").." "..v.Description
end


UserInputService.InputBegan:Connect(function(inputobject, stuffhappening)
    local Focused = UserInputService:GetFocusedTextBox()
    if tostring(Focused) == "ChatBar" or Focused == CommandBar then
        return
    end
    local key = string.gsub(string.lower(tostring(inputobject.KeyCode)), "enum.keycode.", "")


    if key == "leftshift" then
        Tables.SuperRun.ShiftHeld = true
        return
    end
    if key == "w" then
        Tables.SuperRun.WHeld = true
        return
    end
    if key == "s" then
        Tables.SuperRun.SHeld = true
        return
    end
    if key == "a" then
        Tables.SuperRun.AHeld = true
        return
    end
    if key == "d" then
        Tables.SuperRun.DHeld = true
        return
    end
    if key == "l" then
        Toggles.SuperRun = not Toggles.SuperRun
        local currenttext = ""
        if Toggles.SuperRun == true then
            if Variables.RenderStepConnection == nil then
                Variables.RenderStepConnection = game:GetService("RunService").Stepped:Connect(RenderStepped)
            end
            currenttext = "SuperRun is now ON!"
        else
            local LoopOff = false
            for i = 1,#Tables.Lists.LoopedFeatures do
                if Toggles[Tables.Lists.LoopedFeatures[i]] == true then
                    LoopOff = true
                    break
                end
            end
            if Variables.RenderStepConnection ~= nil and LoopOff then
                Variables.RenderStepConnection:Disconnect()
                Variables.RenderStepConnection = nil
            end
            currenttext = "SuperRun is now OFF!"
        end
        game.StarterGui:SetCore("SendNotification", {
            Title = "notification";
            Text = currenttext;
            Icon = "rbxassetid://2541869220";
            Duration = 3;
        })
        return
    end
    if key == "minus" then        
        Tables.SuperRun.RunSpeed = Tables.SuperRun.RunSpeed - 0.1
        game.StarterGui:SetCore("SendNotification", {
            Title = "notification";
            Text = "Your Super-Run speed is now "..tostring(Tables.SuperRun.RunSpeed).."!";
            Icon = "rbxassetid://2541869220";
            Duration = 3;
        })
        return
    end
    if key == "equals" then        
        Tables.SuperRun.RunSpeed = Tables.SuperRun.RunSpeed + 0.1
        game.StarterGui:SetCore("SendNotification", {
            Title = "notification";
            Text = "Your Super-Run speed is now "..tostring(Tables.SuperRun.RunSpeed).."!";
            Icon = "rbxassetid://2541869220";
            Duration = 3;
        })
        return
    end

    if key == "k" then
        Toggles.KillAura = not Toggles.KillAura
        if Toggles.KillAura == true then
            if Variables.RenderStepConnection == nil then
                Variables.RenderStepConnection = game:GetService("RunService").Stepped:Connect(RenderStepped)
            end
            currenttext = "KillAura is now ON!"
        else
            local LoopOff = false
            for i = 1,#Tables.Lists.LoopedFeatures do
                if Toggles[Tables.Lists.LoopedFeatures[i]] == true then
                    LoopOff = true
                    break
                end
            end
            if Variables.RenderStepConnection ~= nil and LoopOff then
                Variables.RenderStepConnection:Disconnect()
                Variables.RenderStepConnection = nil
            end
            currenttext = "KillAura is now OFF!"
        end
        game.StarterGui:SetCore("SendNotification", {
            Title = "notification";
            Text = currenttext;
            Icon = "rbxassetid://2541869220";
            Duration = 3;
        })
    end

    if key == "quote" then
        CommandBar:CaptureFocus()
    end

end)


UserInputService.InputEnded:Connect(function(inputobject, stuffhappening)
    local Focused = UserInputService:GetFocusedTextBox()
    if tostring(Focused) == "ChatBar" or Focused == CommandBar then
        return
    end
    local key = string.gsub(string.lower(tostring(inputobject.KeyCode)), "enum.keycode.", "")

    if key == "leftshift" then
        Tables.SuperRun.ShiftHeld = false
        return
    end
    if key == "w" then
        Tables.SuperRun.WHeld = false
        return
    end
    if key == "s" then
        Tables.SuperRun.SHeld = false
        return
    end
    if key == "a" then
        Tables.SuperRun.AHeld = false
        return
    end
    if key == "d" then
        Tables.SuperRun.DHeld = false
        return
    end
end)

warn([[
COMMANDS CAN BE DONE AS /e command OR :command

:killaura - Attacks any enemy near you
:unkillaura - Turns off killaura

:autoblock - Blocks incoming melee attacks
:unautoblock - Turns off autoblock

:superrun - Enables super run
:unsuperrun - Disables super run

L Key: Toggle super run
- Key: Lower super run speed
+ Key: Increase super run speed


!! PRESS ' TO TYPE IN COMMAND BAR !!


]])

game.StarterGui:SetCore("SendNotification", {
    Title = 'UNTITLED MELEE GAME';
    Text = "SUCCESSFULLY INJECTED, F9 FOR CMDS                    (MADE BY AIDEZ)";
    Icon = "rbxassetid://2541869220";
    Duration = 7;
})


